<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Laundry Buddy – Viva Cheatsheet</title>
  <style>
    :root{ --fg:#111; --muted:#555; --primary:#2563eb; --bg:#fff; --border:#e5e7eb; }
    *{ box-sizing:border-box; }
    html,body{ margin:0; padding:0; background:var(--bg); color:var(--fg); font: 14px/1.6 "Segoe UI", Roboto, Arial, sans-serif; }
    .page{ max-width:900px; margin:24px auto 48px; padding:0 16px; }
    header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
    h1{ font-size:28px; margin:8px 0 0; }
    .subtitle{ color:var(--muted); font-size:13px; }
    .btn{ display:inline-block; padding:8px 14px; border:1px solid var(--border); border-radius:8px; color:#fff; background:var(--primary); text-decoration:none; font-weight:600; }
    .btn.secondary{ background:#fff; color:#111; }
    hr{ border:none; border-top:1px solid var(--border); margin:16px 0; }
    h2{ font-size:18px; margin:20px 0 8px; }
    h3{ font-size:15px; margin:16px 0 6px; }
    ul{ margin:8px 0 8px 20px; }
    code, pre{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    pre{ background:#0b1220; color:#e5e7eb; padding:12px; border-radius:10px; overflow:auto; border:1px solid #111827; }
    .kv{ display:grid; grid-template-columns: 220px 1fr; gap:8px 12px; }
    .kv div{ padding:6px 0; border-bottom:1px dashed var(--border); }
    .muted{ color:var(--muted); }
    .chip{ display:inline-block; padding:2px 8px; border-radius:999px; background:#eef2ff; color:#3730a3; font-size:12px; font-weight:600; margin-right:6px; }
    .callout{ border-left:4px solid var(--primary); background:#f8fafc; padding:10px 12px; border-radius:6px; }
    .two-col{ display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
    @media (max-width: 768px){ .two-col{ grid-template-columns: 1fr; } .kv{ grid-template-columns: 1fr; } }
    @media print{
      .noprint{ display:none !important; }
      body{ background:#fff; }
      .page{ margin:0; max-width:100%; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div>
        <h1>Laundry Buddy – Viva Cheatsheet</h1>
        <div class="subtitle">Stack • Packages • Flows • Endpoints • Run steps</div>
      </div>
      <div class="noprint">
        <a class="btn" href="#" onclick="window.print();return false;">Print / Save as PDF</a>
      </div>
    </header>
    <hr/>

    <section>
      <h2>Tech Stack</h2>
      <div class="chip">Node.js</div>
      <div class="chip">Express</div>
      <div class="chip">MongoDB (Mongoose)</div>
      <div class="chip">JWT Auth</div>
      <div class="chip">Vanilla JS Frontend</div>
      <div class="chip">Service Worker</div>
    </section>

    <section>
      <h2>Key Node Packages (Backend)</h2>
      <ul>
        <li><b>express</b>: HTTP server and routing</li>
        <li><b>mongoose</b>: MongoDB ODM (schemas, validation, refs)</li>
        <li><b>jsonwebtoken</b>: JWT issue/verify for auth</li>
        <li><b>bcryptjs</b>: Password hashing and verification</li>
        <li><b>dotenv</b>: Env vars (<code>.env</code>) for secrets/URIs</li>
        <li><b>cors</b>: Allow browser → API calls</li>
        <li><b>body-parser</b>: Parse JSON/form bodies</li>
        <li><b>express-validator</b>: Request validation (available)</li>
        <li><b>uuid</b>: Legacy ID helper (minimal)</li>
        <li class="muted">nodemon (dev): Auto‑restart during development</li>
      </ul>
    </section>

    <section>
      <h2>Backend Structure</h2>
      <div class="kv">
        <div><code>server.js</code></div><div>Express app, CORS/body parsing, routes, health</div>
        <div><code>config/db.js</code></div><div>Connect MongoDB via <code>MONGODB_URI</code></div>
        <div><code>routes/</code></div><div><code>auth.js</code>, <code>orders.js</code>, <code>tracking.js</code></div>
        <div><code>controllers/</code></div><div><code>authController.js</code>, <code>orderController.js</code>, <code>trackingController.js</code></div>
        <div><code>models/</code></div><div><code>User.js</code>, <code>Order.js</code>, <code>Tracking.js</code></div>
        <div><code>middleware/auth.js</code></div><div>JWT verify + normalize legacy UUID id via email</div>
        <div><code>scripts/migrate-json-to-mongo.js</code></div><div>Imports legacy JSON data into Mongo</div>
      </div>
    </section>

    <section class="two-col">
      <div>
        <h2>Data Models</h2>
        <h3>User</h3>
        <div class="muted">{ name, email, password, phone, address }</div>
        <h3>Order</h3>
        <div class="muted">{ user: ObjectId, orderNumber, serviceType, pickupDate, pickupTime, deliveryDate, items[{ type, count, color }], totalAmount, address, phone, specialInstructions, status, paymentStatus }</div>
        <h3>Tracking</h3>
        <div class="muted">{ user: ObjectId, order: ObjectId, orderNumber, status, estimatedDelivery, timeline[{ status, timestamp, note }] }</div>
      </div>
      <div>
        <h2>Important ENV Vars</h2>
        <pre><code>MONGODB_URI=mongodb://127.0.0.1:27017/laundry_buddy
JWT_SECRET=your_secret
JWT_EXPIRE=7d
LAUNDRY_API_KEY=optional_key_for_prod</code></pre>
      </div>
    </section>

    <section>
      <h2>Auth Flow (JWT)</h2>
      <ul>
        <li>Register/Login → API returns JWT → stored in <code>localStorage</code></li>
        <li>Protected routes require <code>Authorization: Bearer &lt;token&gt;</code></li>
        <li>Middleware normalizes legacy UUID tokens by resolving user via email</li>
        <li>On 401, client clears token and redirects to login</li>
      </ul>
      <div class="kv">
        <div>POST <code>/api/auth/register</code></div><div>Create user and return token</div>
        <div>POST <code>/api/auth/login</code></div><div>Verify password and return token</div>
        <div>GET <code>/api/auth/me</code></div><div>Current user</div>
        <div>PUT <code>/api/auth/profile</code></div><div>Update profile</div>
      </div>
    </section>

    <section class="two-col">
      <div>
        <h2>Order Flow</h2>
        <ul>
          <li>Submit Page → <code>assests/submit.js</code> → POST <code>/api/orders</code></li>
          <li>Controller normalizes items shape and creates <b>Order</b></li>
          <li>History Page → GET <code>/api/orders</code></li>
        </ul>
        <div class="callout">
          Create Order body: <code>{ serviceType, items:[{type,count,color}], ... }</code>
        </div>
      </div>
      <div>
        <h2>Tracking / Status Flow</h2>
        <ul>
          <li>Public read: GET <code>/api/tracking/order/:orderNumber</code></li>
          <li>Dashboard write: PUT <code>/api/tracking/order/:orderNumber</code></li>
          <li>Controller upserts <b>Tracking</b> (status + timeline) and syncs <b>Order.status</b></li>
        </ul>
        <div class="callout">
          Prod hardening: require header <code>X-Laundry-Key</code> matching <code>LAUNDRY_API_KEY</code>.
        </div>
      </div>
    </section>

    <section>
      <h2>Quick Run (Dev)</h2>
      <pre><code>cd "C:\\Users\\ayush\\OneDrive\\Desktop\\Laundary-Buddy\\backend"
npm install
npm start
# Health: http://localhost:3000/api/health</code></pre>
    </section>

    <section>
      <h2>Viva Pointers</h2>
      <ul>
        <li><b>Why JWT?</b> Stateless auth, easy client storage, scalable.</li>
        <li><b>Why Mongoose?</b> Schemas + validation + refs simplify Mongo.</li>
        <li><b>Error handling:</b> 400 validation, 401 auth, 500 generic.</li>
        <li><b>Service Worker:</b> caches assets; do Ctrl+Shift+R after JS updates.</li>
        <li><b>Compatibility:</b> accept both old/new item shapes + legacy UUID tokens.</li>
      </ul>
    </section>

    <footer class="muted" style="margin-top:24px;">
      Tip: Click "Print / Save as PDF" to export. For CLI export, use the provided PowerShell script.
    </footer>
  </div>
</body>
</html>